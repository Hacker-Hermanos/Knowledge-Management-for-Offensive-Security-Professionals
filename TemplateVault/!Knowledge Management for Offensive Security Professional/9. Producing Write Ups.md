---
Topics:
  - "[[01 - Networking]]"
  - "[[01 - Pentesting]]"
  - "[[01 - Programming]]"
  - "[[01 - Red Team]]"
Types:
  - "[[02 - Documentation]]"
tags:
  - KM4OP
date created: Monday, July 8th 2024
date modified: Thursday, January 16th 2025
---

# 9. Producing Write Ups

Now that we've covered plugins and all methodologies related to your vault, let's move on to taking notes while hacking.

For this tutorial, I'll be hacking the "Blueprint" machine from TryHackMe. This is a free room with a straightforward machine, allowing us to focus on the note-taking methodology.

## 9.1 File Preparation

The first step is to prepare your session files.

### Obsidian File Preparation

1. **Create a New Folder**:

- Prepare a new folder in your vault named after the target machine. For this example, I'll create a folder located at *03 - Content* > *Write Ups* > *Blueprint*.

![[Pasted image 20240718162747.png]]

Since I'll be attacking a standalone Windows machine, I need two files generated using my templates.

2. **Create Notes**:

- Right-click on the Blueprint folder and select "New Note."

![[Pasted image 20240718162820.png]]

- The first note, named "Blueprint External," is for external discovery and enumeration, including nmap port scans, general commands for common protocols, and general web application enumeration commands.

> Create a new note and select *Write Up Note* > *External Discovery Note*. You'll be prompted for the target machine's IP, and the Note Generator will auto-populate the new note with this information.

![[Pasted image 20240718165020.png]]

The second note, named "[[Blueprint Internal]]," is for discovery related to privilege escalation and credential access once a foothold has been established.

> Create a new note and select *Write Up Note* > *Windows Host Note*.

![[Pasted image 20240718165046.png]]

### Attacker VM File Preparation

1. **Set Up Main Write Up Directories**:

- On your attacker VM (Kali, in my case), create a new directory named after the target machine in your desired location.

![[Pasted image 20240711155820.png]]

- If you're hacking machines from different platforms, consider adding directories for each platform to keep things organized.

![[Pasted image 20240711155919.png]]

2. **Automating Write Up Subdirectories**:

- To streamline this process, add a new script to your [.zshrc configuration file](https://www.baeldung.com/linux/zsh-configuration-files#3-zshrc). This script will automate the creation of the machine's directory and subdirectories.
- Here is the pseudocode:

![[Pasted image 20240711161138.png]]

- And the final script:

```bash
function mkt(){
    if [ $# -eq 1 ]
    then
        mkdir $1 &&                                                         # main dir
        touch $1/commands.txt &&                                            # commands file
        mkdir $1/reports && mkdir $1/exploits && mkdir $1/tmp &&            # subdirs

        echo "Generated $1, $1/reports, $1/exploits and $1/tmp directories, $1/commands.txt file."
	else
        # working in pwd
        touch commands.txt &&                                               # commands file
        mkdir reports && mkdir exploits && mkdir tmp                        # subdirs
        
		echo "Generated reports, exploits and tmp directories, commands.txt file in $(pwd)."
    fi
}
```

![[Pasted image 20240711171706.png]]

After [sourcing](https://www.geeksforgeeks.org/source-command-in-linux-with-examples/) my new `.zshrc` file, I can use this new function (`mkt`, for "make target") to create a directory for the "Blueprint" machine.

```bash
mkt blueprint
```

![[Pasted image 20240711171736.png]]

Here's a breakdown of the directory structure and its purpose:

- **Exploits**: Stores any scripts and public or custom exploits used to hack this machine.
- **Reports**: Contains port scans, web application directory busting logs, and other scan reports.
- **Tmp**: Holds temporary and backup files used while parsing logs, creating user and password wordlists, etc.
- **Commands.txt**: This file logs all commands used during the attack. It’s particularly useful for complex machines or Active Directory attacks, where commands can be long or encoded. This log helps in case the machine crashes and you need to start over, or if you need to pause and resume later.

## 9.2 Hacking and Taking Notes

First, establish a VPN connection to the machine's network.

![[Pasted image 20240718215132.png]]

Once connected to the network, you can start hacking. Open the [[Blueprint External]] note and begin your discovery process.

The workflow here involves copying and pasting the autogenerated commands into the terminal, then taking screenshots of the output and pasting them into the respective sections of your notes.

### External Discovery

#### Port Scan

```bash
sudo nmap 10.10.15.198 -A -p- -sC -sV -Pn -v --min-rate 1500 -oN 10.10.15.198_nmap
```

> This command is a modified version of the template note's nmap command, using `--min-rate` and `-v` to speed up the scan.

You can start enumerating the open ports while waiting for the nmap scan report.

![[Pasted image 20240718215718.png]]

Once the port scan is complete, paste the output into the scan callout for future reference. Remember to include SMB information if available, as some attacks can be performed when signing is disabled.

![[Pasted image 20240719020653.png]]

![[Pasted image 20240718221349.png]]

> You can also copy and paste the output text directly instead of using screenshots to take advantage of syntax highlighting. Create a code block using triple backticks and use "less" as the code language to activate highlighting.

![[Pasted image 20240718221155.png]]

![[Pasted image 20240718221056.png]]

Then, remove non-relevant sections from your external discovery note until you get to the next corresponding protocol.

![[Pasted image 20240718215854.png]]

#### RPC Discovery

I found valid usernames after enumerating RPC.

![[Pasted image 20240718222118.png]]

I parsed the output of this command and piped it to a new users.txt file.

![[Pasted image 20240718222620.png]]

Finally, I updated my commands.txt file and moved on to the next protocol.

![[Pasted image 20240718222755.png]]

#### SMB Enumeration

I found a share called "users" according to "netexec". I then performed spidering on this share, moved the JSON report to my reports folder, reviewed it, and moved on.

![[Pasted image 20240718230135.png]]

I did not find anything of interest after checking my JSON file.

![[Pasted image 20240718230706.png]]

#### SQL Enumeration

I left a simple brute-force command running and proceeded to the next protocol.

> As you can see from the screenshot, I forgot to add the -L flag to select the usernames wordlist I created earlier. Always double check your commands!

![[Pasted image 20240718231008.png]]

#### HTTP 80

I found a 404 page and started a directory brute-force.

![[Pasted image 20240719014400.png]]

![[Pasted image 20240718234244.png]]

I continued to the SSL page on port 443 while the brute-force was running.

#### HTTP 443

I found a folder with a program name and version.

![[Pasted image 20240718234304.png]]

> On this specific machine, since I found a potential foothold, I tried exploiting it instead of enumerating everything. This is not always the correct approach, and *most of the time you will want to continue enumerating everything and pasting results* before proceeding. This is especially important in exams, as there are multiple rabbit holes.

For now, I collapsed all sub-sections under "Web Application - 445" but "Other Notes" and added my findings in there.

![[Pasted image 20240718235057.png]]

#### Foothold

A quick Google search revealed a script that could exploit this machine.

![[Pasted image 20240718234605.png]]

I saved the exploit in my exploits folder.

![[Pasted image 20240718234950.png]]

After troubleshooting and modifying the script to ignore self-signed certificates, I successfully exploited the vulnerability and obtained a privileged pseudo shell. I documented the entire process.

![[Pasted image 20240719000936.png]]
![[Pasted image 20240719000943.png]]

I then updated my commands.txt file with this information.

![[Pasted image 20240719001206.png]]

#### Privilege Escalation

Using the pseudo shell, I enumerated processes using `tasklist` to check if antivirus was enabled and identified the target architecture. I noted these commands' output in my [[Blueprint External]] note.

![[Pasted image 20240719002628.png]]

Next, I opened a new tab and set up my HTTP server using Apache to host my malware.

![[Pasted image 20240719002732.png]]

I generated an x86 meterpreter binary.

![[Pasted image 20240719003018.png]]

Before transferring it, I used [InvokeWebTransfer](https://github.com/Hacker-Hermanos/InvokeWebTransfer), a custom script that generates transfer commands for files in `/var/www/html`. I piped its output to a new file called "transfer_commands.txt".

![[Pasted image 20240719003211.png]]

> This trick is very useful for exams and complex machines because it allows you to quickly copy and paste the necessary commands for transferring tools.

I located the command for `443.exe` in "transfer_commands.txt".

![[Pasted image 20240719003503.png]]

I copied and pasted this command into the pseudo shell. The logs confirmed that the file was transferred correctly (always check the logs as your exploit might not display output).

![[Pasted image 20240719003641.png]]

I started an encoded handler (encoding wasn't necessary in this case, but it's a good practice).

![[Pasted image 20240719003929.png]]

I executed the exploit.

![[Pasted image 20240719003949.png]]

I received a callback.

![[Pasted image 20240719004013.png]]

I documented the relevant steps in my [[Blueprint External]] note.

![[Pasted image 20240719004144.png]]

> If I had landed on a low-privilege user, I would have continued enumerating by following the [[Blueprint Internal]] note while documenting everything and taking screenshots.

### Internal Discovery

#### Automated Discovery

Even though I already have root access, I'll demonstrate how I would enumerate this machine.

I switched the [[Blueprint Internal]] note display to Source Mode to allow seamless pasting into the "Situational Awareness Notes" callout.

![[Pasted image 20240719005829.png]]

I then transferred an automated recon tool, WinPEAS x86, reviewed the output, and took screenshots of relevant information to populate the [[Blueprint Internal#Internal Discovery Notes|Internal Discovery Notes]].

First, I copied the `certutil` command from "transfer_commands.txt".

![[Pasted image 20240719010446.png]]

Then, I transferred the tool to my target.

![[Pasted image 20240719010521.png]]

After running WinPEAS, I took screenshots of important information and pasted them into the internal discovery notes.

#### Manual Discovery

If I were to perform this enumeration manually, I would split the [[Blueprint Internal]] tab into two (resulting in two tabs with the same note open).

![[Pasted image 20240719004902.png]]

After splitting the tab, I changed the upper note to Source Mode.

![[Pasted image 20240719004954.png]]

Then, I changed the lower note to Reading Mode.

![[Pasted image 20240719005037.png]]

This is the final result.

![[Pasted image 20240719005052.png]]

This setup allows me to copy commands from the Reading Mode tab, paste them in my reverse shell/C2, and paste screenshots in the Source Mode tab.

> This process helps avoid the clunkiness of working with the same Live Preview tab and copying/pasting commands into a callout.

After running the various commands and taking screenshots, I had the following:

![[Pasted image 20240719011410.png]]

![[Pasted image 20240719011422.png]]

**(...)**

![[Pasted image 20240719011442.png]]

There wasn't much of interest here, other than the "Administrator" and "Lab" users (potential credential access targets) and the `inetpub` and `xampp` directories (which might contain files with credentials).

### Credential Access

The next step was to retrieve credentials and flags.

I transferred Mimikatz (x86) to the target.

![[Pasted image 20240719012235.png]]

![[Pasted image 20240719012243.png]]

Executed Mimikatz and extracted all credentials.

![[Pasted image 20240719012414.png]]

I backgrounded the meterpreter session and transferred `BLUEPRINT.txt` (the log file containing all credentials).

![[Pasted image 20240719012617.png]]

Now, I had the NTLM hashes for the "Lab" user and the "Administrator" user.

![[Pasted image 20240719012735.png]]

Don't forget to retrieve `proof.txt`/`root.txt` from the Administrator's desktop.

![[Pasted image 20240719013351.png]]

> This last screenshot is essential for certifications such as OSCP and OSEP.

The TryHackMe room asks for the Lab user's cleartext password. After a few attempts (using "rockyou", "darkweb", and finally the "xato" wordlist), I retrieved Lab's cleartext password.

![[Pasted image 20240719013557.png]]

![[Pasted image 20240719013609.png]]

![[Pasted image 20240719013626.png]]

### Clean Up

Before moving on, I cleaned up my Internal and External notes to remove non-relevant sections.

These are the resulting outlines:

![[Pasted image 20240719114410.png]]

![[Pasted image 20240719114436.png]]

Everything is now organized. We can proceed to produce a report for our exam using these notes.

```ad-warning
title: Better Safe than Sorry

Please note that **my enumeration was not thorough in this tutorial** to keep this document concise.

If you are attempting an exam machine or practicing for your test, I recommend running all commands present in the templates. Take your time modifying them to your liking and ensuring that you understand everything.

In exam environments and complex machines, *rabbit holes are a given*. The only reliable way to avoid wasting time on those and to ensure you reach the end is by performing thorough enumeration (enumerate and document everything) and then attempting to exploit each finding one by one.
```

## 9.3 Preparing a Report

Now we can begin preparing a report! This is the last step for passing offensive security certifications like OSCP, CRTE, and others.

Because we have been diligently taking notes, this step shouldn't stress you.

### Reviewing Your Notes

By now, you should have documents containing screenshots and short descriptions of your progress.

- In Obsidian, I have: [[Blueprint Internal]], [[Blueprint External]].
- On my attacker machine, I have `commands.txt`.

We will use these documents to produce an easy-to-follow report.

### File Preparation

Before starting, create a report template based on your certification guidelines. In this case, I will use Offsec's [OSCP template](https://help.offsec.com/hc/en-us/articles/360046787731-PEN-200-Reporting-Requirements) as my blueprint.

![[Pasted image 20240723053433.png]]

After downloading the document, create two new notes:

- One for the report. Keep it empty for now.

![[Pasted image 20240723053925.png]]

One for the custom report template you will be creating. Keep it empty as well.

![[Pasted image 20240723053911.png]]

### Introduction

Begin by populating the beginning of your report with the OSCP report template.

Scroll down to page 3 where the content begins. Copy everything from the Introduction to the House Cleaning section. Paste this selection into your report note.

![[Pasted image 20240723070517.png]]

Edit the template to include **your own name** (or student ID, depending on the context of this report) throughout the document.

Also, edit the Exam Network IPs to reflect the ones you actually compromised. In this case, I will use Blueprint's IP.

![[Pasted image 20240723054526.png]]

Continue reading and ensure everything makes sense.

### Contents

#### Creating a Report Template

Next, start populating the report. Go to your empty report template.

Copy the next section of the official OSCP template, which includes how you compromised each independent machine. Create a template of this section for your report.

Paste this section into your empty template:

![[Pasted image 20240723055033.png]]

Open the command palette and select *Search & Replace in current file*.

![[Pasted image 20240723055203.png]]

Use the following settings to add a new `#` to each section. This will ensure our template starts with heading level 2 and fits nicely into our report.

![[Pasted image 20240723055325.png]]

Click on *Replace all*.

Then, clear all information, leaving a usable skeleton. This is the document you will use. Completing the report will now be a matter of inserting this template as many times as needed into the report note.

![[Pasted image 20240723055909.png]]

#### Writing the Report

Return to [[My Report]], open the command palette, and select *Insert Template*:

![[Pasted image 20240723060341.png]]

Select the [[OSCP Report Template]] you just created.

![[Pasted image 20240723060418.png]]

Your report should now look like this:

![[Pasted image 20240723060513.png]]

Open your [[Blueprint External]] and [[Blueprint Internal]] notes to the left and start populating the report.

> Keep the official template open to ensure your report matches its style and verbosity.

![[Pasted image 20240723060635.png]]

##### Service Enumeration Section

Start by populating the [[My Report#Service Enumeration|Service Enumeration]] section, which is the easiest:

![[Pasted image 20240723061211.png]]

##### Initial Access Section

Next, move on to the first [[My Report#Initial Access – {METHOD}|Initial Access]] section.

- On your Kali machine, find the URL of the exploit you used in `commands.txt`.

![[Pasted image 20240723061502.png]]

Fill in each section using information from the script (in your own words) and your notes.

![[Pasted image 20240723062258.png]]
![[Pasted image 20240723062314.png]]

##### Initial Access Walkthrough Section

For the Initial Access Walkthrough section, copy and paste your notes and edit them to ensure the steps are clear and easy to follow.

![[Pasted image 20240723063915.png]]
![[Pasted image 20240723063934.png]]
![[Pasted image 20240723063946.png]]

##### Privilege Escalation Walkthrough Section

Follow a similar approach for this section.

![[Pasted image 20240723064019.png]]

##### Post Exploitation Section

Paste your `whoami && ipconfig && type proof.txt` command screenshot. Remove the Linux version of this command since it does not apply to this machine.

![[Pasted image 20240723064040.png]]

##### Other Machines

Repeat all steps outlined in the [[9. Producing Write Ups#Writing the Report|Writing the Report]] section for each machine you hacked.

#### Formatting the Report

Format the report by enumerating each section.

![[Pasted image 20240723064444.png]]

Add a table of contents section at the beginning of the document.

![[Pasted image 20240723064856.png]]

To do this, select the portion before the main heading:

![[Pasted image 20240723064931.png]]

Use the following table of contents plugin settings:

![[Pasted image 20240723064950.png]]

Open the command palette and select *Create table of contents*:

![[Pasted image 20240723065021.png]]

Move it to the beginning of the first section.

Finally, remember to lint the file.

![[Pasted image 20240723065109.png]]

```ad-attention

If this were a real report, I would proofread every section again, making sure that:

- The report makes sense in the context of my exam environment.
- My name and ID are present throughout.
```

Your report is ready!

#### Printing the Report (PDF)

Open the command palette and select *Export to PDF*:

![[Pasted image 20240723065228.png]]

Tweak the PDF settings to your liking. These are mine (Downscaling is set to 80 and Page size is A4):

![[Pasted image 20240723065306.png]]

Now you have a beautiful report ready for submission.

![[Pasted image 20240723065351.png]]
**(...)**
![[Pasted image 20240723065430.png]]

## Conclusion

**Congratulations on finishing this course!** Give yourself a pat on the back and treat yourself to some ice cream for making it this far.

I had a blast writing this course, and I hope you found it useful. Please share this project with fellow professionals if you liked it.

Feel free to collaborate on this project if you have any ideas.

> Remember, this is just a blueprint for your note-taking methodology. I encourage you to keep experimenting and adapting settings and templates to fit your needs.

*Thank you from the [Hacker Hermanos](https://linktr.ee/hackerhermanos) team!*

Robert Pimentel
Caitlin Farley
Rafael Pimentel
